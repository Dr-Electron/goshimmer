name: Test GoShimmer
on:
  push:
  pull_request:
    types: [opened, reopened]
jobs:

  build:
    name: Unit tests
    runs-on: ubuntu-latest
    steps:

    - name: Set up Go 1.14
      uses: actions/setup-go@v1
      with:
        go-version: 1.14

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2

    - name: Run Tests
      run: go test ./...

  integration-test:
    name: Integration Tests
    runs-on: ubuntu-latest
    steps:

    - name: Check out code
      uses: actions/checkout@v2

    - name: Build GoShimmer Docker network
      run: docker-compose -f tools/integration-tests/docker-compose.yml up -d --scale peer_replica=5

    - name: Dispay containers
      run: docker ps -a

    - name: Run integration tests
      run: docker-compose -f tools/integration-tests/tests/docker-compose.yml up --exit-code-from tester

    - name: Clean up
      run: docker-compose -f tools/integration-tests/docker-compose.yml down --rmi all --remove-orphan --volumes